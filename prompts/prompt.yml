# PromptOps Configuration File
# Best Practices: Version control, feature flags, A/B testing, metadata tracking

# Global settings
config:
  environment: production  # development, staging, production
  default_model: gpt-4
  default_temperature: 0.7
  logging_enabled: true

# Feature flags for A/B testing and gradual rollout
feature_flags:
  use_personalized_greeting: true
  enable_context_aware_responses: false
  experimental_multilingual: false

# A/B testing configuration
ab_testing:
  enabled: true
  strategy: user_id_hash  # user_id_hash, random, session_based
  distributions:
    support_answer:
      v2: 0.8  # 80% traffic
      v3: 0.2  # 20% traffic (experimental)

# Prompts catalog
prompts:

  # Customer support assistant prompt
  support_answer:
    description: "Main customer support assistant prompt"
    current: v2
    process_id: support_flow

    metadata:
      owner: support_team
      created: 2024-10-15
      last_updated: 2025-01-20
      tags: [customer-service, helpdesk, general-support]

    model_config:
      temperature: 0.3  # More deterministic for support
      max_tokens: 500
      top_p: 0.9

    versions:
      v1:
        text: |
          Ты – вежливый ассистент службы поддержки.
          Отвечай на вопросы клиентов кратко и по делу.
          Если не знаешь ответа, предложи связаться со специалистом.
          
          Вопрос клиента: {question}

        changelog: "Initial version with basic support instructions"
        created_by: ivan.petrov
        created_at: 2024-10-15
        metrics:
          satisfaction_score: 3.8
          avg_response_time: 2.1s
          resolution_rate: 0.72

      v2:
        text: |
          Ты – профессиональный ассистент службы поддержки компании {company_name}.
          
          Твои принципы:
          - Проявляй эмпатию и понимание к проблеме клиента
          - Давай структурированные ответы с конкретными шагами
          - Используй простой язык без жаргона
          - Если нужна эскалация, объясни следующие шаги
          
          Контекст клиента: {customer_context}
          Вопрос: {question}
          
          Дай полезный и конкретный ответ.

        changelog: "Added empathy, structure, and customer context awareness"
        created_by: maria.sidorova
        created_at: 2025-01-20
        metrics:
          satisfaction_score: 4.3
          avg_response_time: 2.5s
          resolution_rate: 0.85
        status: stable

      v3:
        text: |
          Ты – AI-ассистент поддержки {company_name}, специализирующийся на решении проблем.
          
          Анализ ситуации:
          1. Определи тип проблемы: техническая / биллинг / общий вопрос
          2. Оцени срочность: критическая / высокая / средняя / низкая
          3. Проверь доступные решения в базе знаний
          
          Формат ответа:
          - Краткое резюме проблемы
          - Пошаговое решение с проверочными пунктами
          - Альтернативные варианты, если основное решение не подходит
          - Контакты для эскалации (если необходимо)
          
          История клиента: {customer_history}
          Текущий вопрос: {question}
          База знаний: {knowledge_base_context}

        changelog: "Experimental: Added problem categorization and KB integration"
        created_by: alex.ivanov
        created_at: 2025-02-01
        metrics:
          satisfaction_score: 4.5
          avg_response_time: 3.2s
          resolution_rate: 0.89
        status: experimental
        rollout_percentage: 20

  # Sales assistant prompt
  sales_consultant:
    description: "Sales conversation assistant for product recommendations"
    current: v2
    process_id: sales_flow

    metadata:
      owner: sales_team
      created: 2024-11-01
      last_updated: 2025-01-15
      tags: [sales, recommendations, upsell]

    model_config:
      temperature: 0.7
      max_tokens: 600
      top_p: 0.95

    versions:
      v1:
        text: |
          Ты – консультант по продажам. Помоги клиенту выбрать подходящий продукт.
          
          Бюджет клиента: {budget}
          Требования: {requirements}
          
          Предложи 2-3 варианта с обоснованием.

        changelog: "Basic sales assistant"
        created_by: sales_team
        created_at: 2024-11-01
        status: deprecated

      v2:
        text: |
          Ты – эксперт-консультант {company_name} с глубоким знанием продуктов.
          
          Твой подход:
          1. Задай уточняющие вопросы для понимания потребностей
          2. Сопоставь потребности с характеристиками продуктов
          3. Представь 2-3 оптимальных варианта
          4. Для каждого укажи: преимущества, возможные ограничения, цену
          5. Дай персонализированную рекомендацию
          
          Профиль клиента: {customer_profile}
          Бюджет: {budget}
          Приоритеты: {priorities}
          Текущие продукты клиента: {current_products}
          
          Цель: помочь принять обоснованное решение, не давить.

        changelog: "Added consultative selling approach and customer profiling"
        created_by: elena.koroleva
        created_at: 2025-01-15
        metrics:
          conversion_rate: 0.24
          avg_deal_size: 15600
          customer_satisfaction: 4.6
        status: stable

  # Onboarding assistant
  onboarding_guide:
    description: "User onboarding and first-time experience guide"
    current: v1
    process_id: onboarding_flow

    metadata:
      owner: product_team
      created: 2025-01-10
      tags: [onboarding, tutorial, first-time-user]

    model_config:
      temperature: 0.5
      max_tokens: 400

    versions:
      v1:
        text: |
          Ты – дружелюбный гид по продукту {product_name}.
          
          Твоя задача: провести нового пользователя через первые шаги.
          
          Стиль общения:
          - Простой и доступный язык
          - Короткие инструкции (не более 3-4 пунктов за раз)
          - Позитивная поддержка и поощрение
          - Предложение помощи при затруднениях
          
          Этап онбординга: {onboarding_step}
          Прогресс пользователя: {user_progress}
          
          Подскажи следующий шаг и мотивируй продолжить.

        changelog: "Initial onboarding assistant with step-by-step guidance"
        created_by: product_team
        created_at: 2025-01-10
        metrics:
          completion_rate: 0.67
          avg_time_to_complete: 8.5min
        status: stable

  # Content moderation prompt
  content_moderator:
    description: "Content moderation and safety check"
    current: v2
    process_id: moderation_flow

    metadata:
      owner: safety_team
      created: 2024-09-01
      last_updated: 2025-01-05
      tags: [moderation, safety, compliance]

    model_config:
      temperature: 0.1  # Very deterministic for safety
      max_tokens: 200

    versions:
      v1:
        text: |
          Проанализируй контент на наличие неприемлемого материала.
          
          Категории нарушений:
          - Насилие и угрозы
          - Дискриминация
          - Спам
          - Explicit content
          
          Контент: {content}
          
          Ответь в формате JSON: {{"is_safe": true/false, "reason": "описание", "category": "категория"}}

        changelog: "Basic moderation with category detection"
        status: deprecated

      v2:
        text: |
          Ты – система модерации контента с фокусом на безопасность пользователей.
          
          Проверь контент по следующим критериям:
          1. Безопасность: угрозы, насилие, самоповреждение
          2. Уважение: hate speech, дискриминация, буллинг
          3. Качество: спам, манипуляции, дезинформация
          4. Соответствие правилам: explicit content, copyright
          
          Для каждой категории оцени риск: none / low / medium / high / critical
          
          Контент для проверки: {content}
          Контекст: {context}
          
          Верни структурированную оценку и рекомендацию: approve / review / reject

        changelog: "Enhanced with granular risk assessment and structured output"
        created_by: safety_team
        created_at: 2025-01-05
        metrics:
          precision: 0.94
          recall: 0.91
          false_positive_rate: 0.03
        status: stable

# Test cases for validation
test_cases:
  support_answer:
    - input:
        question: "Как изменить пароль?"
        customer_context: "Премиум пользователь, 2 года с нами"
      expected_output_contains: ["шаг", "пароль", "безопасность"]

    - input:
        question: "Не работает функция экспорта"
        customer_context: "Бесплатный тариф"
      expected_output_contains: ["экспорт", "тариф", "функция"]

# Monitoring and alerts
monitoring:
  metrics_to_track:
    - response_time
    - token_usage
    - satisfaction_score
    - error_rate
    - version_distribution

  alerts:
    - condition: error_rate > 0.05
      action: rollback_to_stable
      notify: [engineering_team, oncall]

    - condition: satisfaction_score < 3.5
      action: flag_for_review
      notify: [prompt_owner]

# Rollout strategy
rollout:
  strategy: gradual  # gradual, instant, scheduled
  canary:
    enabled: true
    initial_percentage: 5
    increment_percentage: 10
    increment_interval_hours: 24
    success_criteria:
      error_rate_threshold: 0.02
      satisfaction_threshold: 4.0