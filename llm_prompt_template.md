System persona: 
 –¢—ã ‚Äì senior python developer, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–µ–π Langchain, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç –∏ —É–º–µ–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å
–ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å LLM. https://docs.langchain.com/oss/python/langchain/overview

System tone:
–û—Ç–≤–µ—á–∞–π –∫–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ —Å—É—Ç–∏, –æ —á–µ–º —Ç–µ–±—è –ø–æ–ø—Ä–æ—Å–∏–ª–∏. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å –∏–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω, —Ç–æ —Ç–∞–∫ –∏ —Å–∫–∞–∂–∏. 

Context:
–®–∞–≥ 3. –ü–æ–¥–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ –º–∏–Ω–∏-–¥–∞—Ç–∞—Å–µ—Ç–µ
–¶–µ–ª—å: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—ã—Ç–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ chunk_size –∏ overlap –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—é—Ç –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤. –ú—ã –ø—Ä–æ–≤–µ–¥—ë–º –Ω–µ–±–æ–ª—å—à–æ–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: –≤–æ–∑—å–º—ë–º –º–∏–Ω–∏-–¥–∞—Ç–∞—Å–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ –Ω–∏–º), –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –µ–≥–æ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö, –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ RAG –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–∏ —Å –∫–∞–∫–∏–º –æ–±—ä—ë–º–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥–±–æ—Ä –≤ –∏–¥–µ–∞–ª–µ —Ç—Ä–µ–±—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É –Ω–∞—Å –µ—Å—Ç—å —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤). –ï—Å–ª–∏ —Ç–∞–∫–æ–≤—ã–µ –µ—Å—Ç—å, –º–æ–∂–Ω–æ –∏–∑–º–µ—Ä—è—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ (–∏–ª–∏ precision@k, recall@k ‚Äì –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–∏—Å–∫–∞). –ï—Å–ª–∏ —è–≤–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–µ—Ç, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∫–æ—Å–≤–µ–Ω–Ω–æ:

–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –≤—Ä—É—á–Ω—É—é –æ—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

–õ–∏–±–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM-as-a-judge, —Å–ø—Ä–æ—Å–∏–≤: "–æ—Ç–≤–µ—Ç, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ A, –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –ª–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º?".

–ù–æ, —É—á–∏—Ç—ã–≤–∞—è —É—á–µ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –≤–æ–∑–º–æ–∂–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥:

–ó–∞–¥–∞—Ç—å 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: (500,50), (800,100), (1200,0) —Ç–æ–∫–µ–Ω–æ–≤).

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–∞–±–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.

–°—Ä–∞–≤–Ω–∏—Ç—å, –≥–¥–µ –æ—Ç–≤–µ—Ç—ã –ª—É—á—à–µ (–ø–æ–ª–Ω–µ–µ, –º–µ–Ω—å—à–µ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π).

–¢–∞–∫–∂–µ –æ—Ç–º–µ—Ç–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—á–∞–Ω–∫–æ–≤) –æ–±—ã—á–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ—Å—å –∏–∑ –ø–æ–∏—Å–∫–∞.

–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –ø—Ä–∏—ë–º—ã:

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞: –ï—Å–ª–∏ —É –≤–∞—Å, —Å–∫–∞–∂–µ–º, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ 3 –≤–æ–ø—Ä–æ—Å–∞ –ø–æ –Ω–µ–π, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç—ã –≤–Ω—É—Ç—Ä–∏. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Ç–∞–∫–∏–µ, —á—Ç–æ –æ—Ç–≤–µ—Ç—ã —Ä–∞–∑–Ω–æ–π –¥–ª–∏–Ω—ã –∏–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.

–ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è: –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ –ø–∞–º—è—Ç–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, FAISS) —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –º–æ–∂–Ω–æ –¥–∞–∂–µ –∑–∞—Ä–∞–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ç—å embedding –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ—Ç–æ–º –ø—Ä–æ—Å—Ç–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É... –Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç. –ü—Ä–æ—â–µ, –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ–±–æ–ª—å—à–∏–µ, –ø—Ä—è–º–æ —Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞: –ï—Å–ª–∏ –µ—Å—Ç—å —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å, –≤—Ö–æ–¥–∏—Ç –ª–∏ —ç—Ç–∞–ª–æ–Ω –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –≤–æ–ø—Ä–æ—Å "–ö–æ–≥–¥–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è?", —ç—Ç–∞–ª–æ–Ω "1999", –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ "1999" –≤ –æ—Ç–≤–µ—Ç–µ). –ù–æ –ª—É—á—à–µ, –∫–æ–Ω–µ—á–Ω–æ, –≥–ª–∞–∑–∫–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: –ú–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å: –ø–æ–ø—Ä–æ—Å–∏—Ç—å GPT-5 –≤—ã—Å—Ç—É–ø–∏—Ç—å —Å—É–¥—å—ë–π ‚Äì —Å—Ä–∞–≤–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –∏—Å—Ö–æ–¥–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º. –ù–æ —ç—Ç–æ —É–∂–µ —Å–ª–æ–∂–Ω–µ–µ.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞: –í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ, –ø–µ—á–∞—Ç–∞–π—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω:

–ö–∞–∫–∏–µ top-k —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –Ω–∞—à–ª–∏—Å—å (–∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ),

–ö–∞–∫–æ–π –æ—Ç–≤–µ—Ç –¥–∞–ª–∞ –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ –≤—ã —Ä–µ–∞–ª—å–Ω–æ –º–æ–¥–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç–µ),

–ò–ª–∏, –µ—Å–ª–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç–µ –º–æ–¥–µ–ª—å (—á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã), —Ö–æ—Ç—è –±—ã –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –ª–µ–∂–∏—Ç –≤ —ç—Ç–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ, —Å–æ—Å—Ç–∞–≤–∏—Ç –ª–∏ –∏–∑ –Ω–∏—Ö –æ—Ç–≤–µ—Ç. –ò–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å: —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –µ—Å–ª–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ top-k, —Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞. –≠—Ç–æ –º–µ—Ç—Ä–∏–∫–∞ Recall@k: –Ω–∞—à–ª–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—Ç. –ï—ë –ø—Ä–æ—â–µ –≤—ã—á–∏—Å–ª–∏—Ç—å: –Ω—É–∂–µ–Ω —ç—Ç–∞–ª–æ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ —Ö–æ—Ç—è –±—ã –∑–Ω–∞–Ω–∏–µ, —á—Ç–æ "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç".

–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

–ù–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ç–µ—Å—Ç: 5-10 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –∏–Ω–∞—á–µ –¥–æ–ª–≥–æ. –≠—Ç–æ –≤–µ–¥—å –º–∏–Ω–∏-–Ω–∞–±–æ—Ä.

–ü–æ–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –í–æ–∑—å–º–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π (–æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ) –∏ –≤–æ–ø—Ä–æ—Å, –≥–¥–µ –æ—Ç–≤–µ—Ç –∞–±–∑–∞—Ü. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

–£—á–µ—Ç random –≤–ª–∏—è–Ω–∏—è: –ï—Å–ª–∏ –≤–∞—à RAG –≤–∫–ª—é—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º LLM –æ—Ç–≤–µ—á–∞–µ—Ç —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏), —Ç–æ –æ—Ç–≤–µ—Ç—ã –º–æ–≥—É—Ç —á—É—Ç—å –æ—Ç–ª–∏—á–∞—Ç—å—Å—è. –õ—É—á—à–µ–µ ‚Äì —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å temperature=0 –¥–ª—è LLM, —á—Ç–æ–±—ã –æ–Ω –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –±—Ä–∞–ª —Ñ–∞–∫—Ç—ã.

–í—ã–±–æ—Ä –æ–ø—Ç–∏–º—É–º–∞: –ú–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ —Ä–∞–∑–Ω–∏—Ü—ã —Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–µ –±—É–¥–µ—Ç. –¢–æ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω—é–∞–Ω—Å—ã: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è X —á—É—Ç—å –ª—É—á—à–µ –ø–æ –ø—Ä–æ—Å—Ç–æ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ–Ω—å—à–µ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—Ç—å), –∏–ª–∏ –¥–∞—ë—Ç –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã ‚Äì –≤—ã–±–∏—Ä–∞–π—Ç–µ –µ—ë. –ï—Å–ª–∏ –æ–¥–Ω–∞ —è–≤–Ω–æ –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è (–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç), –∞ –¥—Ä—É–≥–∞—è –æ–∫ ‚Äì –≤—ã–≤–æ–¥ –æ—á–µ–≤–∏–¥–µ–Ω.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –º—ã –ø–æ–¥–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –º–∏–Ω–∏-–¥–∞—Ç–∞—Å–µ—Ç–µ. –≠—Ç–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ç–∞–∫ –∂–µ, –Ω–æ –æ–±—ã—á–Ω–æ —Ç—Ä–µ–Ω–¥—ã –ø–æ—Ö–æ–∂–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–∏–¥–∏–º, —á—Ç–æ 300 —Ç–æ–∫–µ–Ω–æ–≤ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ (—á–∞—Å—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω—Ñ—ã), —Ç–æ –∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö 300 –±—É–¥–µ—Ç –º–∞–ª–æ–≤–∞—Ç–æ.

–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (–ø—Å–µ–≤–¥–æ-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç):

# üëá –Ω–æ–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã
from langchain.text_splitter import RecursiveCharacterTextSplitter, TokenTextSplitter
from langchain.schema import Document

# ‚úîÔ∏è –ß—ë—Ç–∫–∞—è —Å—Ö–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
configs = [
    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–∏—Å–∫–∞
    {"name": "sparse_optimized", "chunk_size": 300, "chunk_overlap": 30, "note": "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è BM25"},
    {"name": "dense_optimized", "chunk_size": 800, "chunk_overlap": 100, "note": "–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞"}, 
    {"name": "hybrid_balanced", "chunk_size": 500, "chunk_overlap": 50, "note": "–ö–æ–º–ø—Ä–æ–º–∏—Å—Å –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞"},
]


def make_splitter(cfg):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–ª–∏—Ç—Ç–µ—Ä –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è."""
    if cfg["unit"] == "tokens":
        # encoding_name 'cl100k_base' —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–æ–¥–µ–ª–µ–π GPT-4/5
        return TokenTextSplitter(
            encoding_name="cl100k_base",
            chunk_size=cfg["chunk_size"],
            chunk_overlap=cfg["chunk_overlap"]
        )
    # –ü–æ —Å–∏–º–≤–æ–ª–∞–º ‚Äî –∫–∞–∫ –±—ã–ª–æ, –Ω–æ —è–≤–Ω–æ
    return RecursiveCharacterTextSplitter(
        chunk_size=cfg["chunk_size"],
        chunk_overlap=cfg["chunk_overlap"],
        separators=["\n\n", "\n", ". ", " ", ""],
    )

# --- –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ ---
for cfg in configs:
    splitter = make_splitter(cfg)
    chunks = []
    for doc in docs_small:
        for chunk_text in splitter.split_text(doc.page_content):
            md = (doc.metadata or {}).copy() if hasattr(doc, "metadata") else {}
            chunks.append(Document(page_content=chunk_text, metadata=md))

    print(f"\n–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: {cfg['name']} "
          f"({cfg['unit']}, size={cfg['chunk_size']}, overlap={cfg['chunk_overlap']}), "
          f"–≤—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤={len(chunks)}")

    db = FAISS.from_documents(chunks, embedding_model)

    for q in questions:
        k = cfg.get("k", 2)
        docs_and_scores = db.similarity_search_with_score(q, k=k)
        print(f"Q: {q}")
        for doc, score in docs_and_scores:
            src = (doc.metadata or {}).get("source", "‚Äî")
            page = (doc.metadata or {}).get("page", "‚Äî")
            snippet = doc.page_content[:80].replace("\n", " ")
            print(f" - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score={score:.4f}): {snippet}... [{src} —Å—Ç—Ä.{page}]")


                  
–°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–∞—Ä–µ–∑–∞–µ—Ç docs_small –Ω–∞ —á–∞–Ω–∫–∏ –∏ —Å—Ç—Ä–æ–∏—Ç FAISS-–∏–Ω–¥–µ–∫—Å. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –æ–Ω –ø–µ—á–∞—Ç–∞–µ—Ç –¥–≤–∞ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Å –∏—Ö –æ—Ü–µ–Ω–∫–∞–º–∏. –ú—ã –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ (—ç–∫–æ–Ω–æ–º–∏–º –≤—Ä–µ–º—è –∏ —Ç–æ–∫–µ–Ω—ã) ‚Äî –ø–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º —É–∂–µ –≤–∏–¥–Ω–æ, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: size=500, overlap=50, –≤—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤=45
Q: –í –∫–∞–∫–æ–º –≥–æ–¥—É –æ—Å–Ω–æ–≤–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è?
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.12): ...–∫–æ–º–ø–∞–Ω–∏—è –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1999 –≥–æ–¥—É, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ... [ustav_company —Å—Ç—Ä.1]
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.08): ...–û—Å–Ω–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ —Ü–µ–ª—å –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω–¥—É—Å—Ç—Ä–∏—é... [ustav_company —Å—Ç—Ä.1]
Q: –ö–∞–∫–æ–≤–∞ –º–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏?
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.15): ...–ú–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤... [ustav_company —Å—Ç—Ä.2]
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.09): ...–≤–∏–¥–µ–Ω–∏–µ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã... [ustav_company —Å—Ç—Ä.2]
...
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: size=1200, overlap=0, –≤—Å–µ–≥–æ —á–∞–Ω–∫–æ–≤=20
Q: –í –∫–∞–∫–æ–º –≥–æ–¥—É –æ—Å–Ω–æ–≤–∞–Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è?
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.20): ...–∫–æ–º–ø–∞–Ω–∏—è XYZ –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1999 –≥–æ–¥—É. –û—Å–Ω–æ–≤–∞—Ç–µ–ª–∏... [ustav_company —Å—Ç—Ä.1]
 - –Ω–∞–π–¥–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç (score=0.05): ...–≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –∫–æ–º–ø–∞–Ω–∏—è –Ω–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç... [ustav_company —Å—Ç—Ä.3]
...

                  
–ò–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ –æ–±–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç –≥–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (1999) —É–∂–µ –≤ –ø–µ—Ä–≤–æ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–µ. –í —Ä–µ–∂–∏–º–µ 500/50 –ø–æ–ø–∞–¥–∞—é—Ç—Å—è –¥–≤–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –∫—É—Å–æ—á–∫–∞ (–æ–¥–∏–Ω —Å —Ç–æ—á–Ω—ã–º –≥–æ–¥–æ–º, –≤—Ç–æ—Ä–æ–π ‚Äî —Å–æ—Å–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç). –í 1200/0 –¥–ª–∏–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Å—Ä–∞–∑—É –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—ë.
–ú–∏—Å—Å–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ —Ç–æ–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö.
–ê –≤–æ—Ç –¥–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (¬´–ø—Ä–æ–¥—É–∫—Ç, –≤—ã–ø—É—â–µ–Ω–Ω—ã–π –≤ 2020¬ª) –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ 500/50 –Ω—É–∂–Ω—ã–π —Ç–µ–∫—Å—Ç —Ä–∞–∑—Ä–µ–∑–∞–ª—Å—è –∏ –Ω–µ –ø–æ–ø–∞–ª –≤ top-2, —Ç–æ–≥–¥–∞ –∫–∞–∫ –ø—Ä–∏ 1200/0 –æ–Ω –≤—Ö–æ–¥–∏—Ç —Ü–µ–ª–∏–∫–æ–º.

–¢–∞–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö –∏ –≤—ã–±—Ä–∞—Ç—å –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—É—é.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º: –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –≤—ã –¥–æ–ª–∂–Ω—ã —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥: –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–±—Ä–∞–Ω—ã. –ß–∞—â–µ –≤—Å–µ–≥–æ: "–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ–∫–∞–∑–∞–ª—Å—è —Ä–∞–∑–º–µ—Ä ~X —Ç–æ–∫–µ–Ω–æ–≤ —Å overlap ~Y, —Ç.–∫. –ø—Ä–∏ —ç—Ç–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –æ—Ç–≤–µ—Ç—ã –ø–æ–ª–Ω–æ –ø–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–∏–º-–¥–≤—É–º—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏, –∞ –ª–∏—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–∏–Ω–∏–º–∞–ª–µ–Ω." –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –≤—ã –∫ —ç—Ç–æ–º—É –ø—Ä–∏—à–ª–∏ ‚Äì —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ —Å—Ä–∞–≤–Ω–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏ –∑–∞–º–µ—Ç–∏–ª–∏ —Ç–æ-—Ç–æ. –í –æ—Ç—á—ë—Ç (—à–∞–≥ 4) –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –Ω–∞–ø—Ä–∏–º–µ—Ä,
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è A –æ—à–∏–±–ª–∞—Å—å –Ω–∞ 2 –∏–∑ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ (—Ç.–∫. –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—ã–ª–∞ —Ä–∞–∑–±–∏—Ç–∞), –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è B –æ—Ç–≤–µ—Ç–∏–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –≤—Å–µ 5.
–ò–ª–∏ –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ A –∏–Ω–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å —Ç—è–Ω—É—Ç—å 4 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (–æ—Ç–≤–µ—Ç —Ä–∞–∑–º–∞–∑–∞–Ω), –∞ –≤ B –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 2..
–¢–∞–∫–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –¥–∞—é—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

–í –∫–∞—á–µ—Å—Ç–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–Ω–∏–≥–∞ –ø–æ —Ç—Ä–µ–π–¥–∏–Ω–≥—É ORDER_FLOW_Trading_Setups

–ï—Å—Ç—å —Ñ–∞–π–ª —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ –∫ —Ä–∞–∑–±–∏–µ–Ω–∏—é —Ç–µ–∫—Å—Ç–∞ DocumentPreprocessor


Task:
–ò–∑—É—á–∏ –∑–∞–¥–∞–Ω–∏–µ –∏ —Ñ–∞–π–ª –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∞ —Ä–∞–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

- –∫–∞–∫–∏–µ –µ—Å—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å—Ç–µ–ø—ã
- –∫–∞–∫–∏–µ –µ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ —Å–µ—Ç–∞–ø—ã 
- –∫–∞–∫ –∏—Ö –≤–µ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ 

–í –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏–π –∏—Å–ø–æ–ª—å–∑—É–π 
llm = ChatOllama(model="deepseek-v3.1:671b-cloud",
                 base_url="https://ollama.com",
                 temperature=0.0)

embed_model = OllamaEmbeddings(model="qwen3-embedding:8b")

–≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–¥ 
qdrant_client = QdrantClient("http://localhost:6333")

vector_store = QdrantVectorStore.from_documents(
    documents=splitted_docs,
    embedding=embed_model,
    url="http://localhost:6333",
    collection_name="order_flow_trading_setups_collection"
)

–î–æ–±–∞–≤—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ 

Constraint: 
    - –æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ—Ç –≤–æ–ø—Ä–æ—Å, —á—Ç–æ —Ç–µ–±—è –ø–æ–ø—Ä–æ—Å–∏–ª–∏ 
    - –Ω–µ –¥–æ–±–∞–≤–ª—è–π –≤ –æ—Ç–≤–µ—Ç, –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ 
    - –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, readme –∏ –ø—Ä–æ—á–µ–≥–æ, –µ—Å–ª–∏ —Ç–µ–±—è —è–≤–Ω–æ –æ–± —ç—Ç–æ–º –Ω–µ –ø–æ–ø—Ä–æ—Å–∏–ª–∏
    - –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–∏—à–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤, –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ readme, –ø–æ–∫–∞ —è —Å–∞–º —Ç–µ–±—è –æ–± —ç—Ç–æ–º –Ω–µ –ø–æ–ø—Ä–æ—à—É 
    - –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Langchain 
